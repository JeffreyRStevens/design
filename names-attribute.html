<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3 Names attribute | Tidyverse design guide</title>
<meta name="author" content="Tidyverse team">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="3 Names attribute | Tidyverse design guide">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3 Names attribute | Tidyverse design guide">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115082821-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="3.1 Coverage in tidyverse style guide Existing name-related topics in http://style.tidyverse.org File names Object names Argument names Function names  3.2 The names attribute of an object Here we...">
<meta property="og:description" content="3.1 Coverage in tidyverse style guide Existing name-related topics in http://style.tidyverse.org File names Object names Argument names Function names  3.2 The names attribute of an object Here we...">
<meta name="twitter:description" content="3.1 Coverage in tidyverse style guide Existing name-related topics in http://style.tidyverse.org File names Object names Argument names Function names  3.2 The names attribute of an object Here we...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Tidyverse design guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="structure.html"><span class="header-section-number">1</span> Structure</a></li>
<li><a class="" href="unifying-principles.html"><span class="header-section-number">2</span> Unifying principles</a></li>
<li class="book-part">Implementation</li>
<li><a class="active" href="names-attribute.html"><span class="header-section-number">3</span> Names attribute</a></li>
<li><a class="" href="call-data-details.html"><span class="header-section-number">4</span> Name details arguments</a></li>
<li><a class="" href="function-names.html"><span class="header-section-number">5</span> Function names</a></li>
<li class="book-part">Interface: inputs</li>
<li><a class="" href="args-hidden.html"><span class="header-section-number">6</span> Avoid hidden arguments</a></li>
<li><a class="" href="args-data-details.html"><span class="header-section-number">7</span> Data, descriptors, details</a></li>
<li><a class="" href="args-independence.html"><span class="header-section-number">8</span> Avoid dependencies between arguments</a></li>
<li><a class="" href="case-study-setnames.html"><span class="header-section-number">9</span> Case study: setNames()</a></li>
<li class="book-part">Interface: default values</li>
<li><a class="" href="def-required.html"><span class="header-section-number">10</span> Required args shouldn’t have defaults</a></li>
<li><a class="" href="cs-rep.html"><span class="header-section-number">11</span> Case study: rep()</a></li>
<li><a class="" href="def-enum.html"><span class="header-section-number">12</span> Enumerate possible options</a></li>
<li><a class="" href="def-magical.html"><span class="header-section-number">13</span> Avoid magical defaults</a></li>
<li><a class="" href="def-short.html"><span class="header-section-number">14</span> Keep defaults short and sweet</a></li>
<li><a class="" href="def-inform.html"><span class="header-section-number">15</span> Explain important defaults</a></li>
<li><a class="" href="def-user.html"><span class="header-section-number">16</span> User settable defaults</a></li>
<li><a class="" href="cs-rgb.html"><span class="header-section-number">17</span> Case study: rgb()</a></li>
<li class="book-part">Interface: ...</li>
<li><a class="" href="dots-position.html"><span class="header-section-number">18</span> Data, dots, details</a></li>
<li><a class="" href="dots-data.html"><span class="header-section-number">19</span> Making data with …</a></li>
<li><a class="" href="dots-prefix.html"><span class="header-section-number">20</span> Dot prefix</a></li>
<li><a class="" href="dots-inspect.html"><span class="header-section-number">21</span> Inspect the dots</a></li>
<li><a class="" href="cs-mapply-pmap.html"><span class="header-section-number">22</span> Case study: mapply() vs pmap()</a></li>
<li class="book-part">Interface: outputs</li>
<li><a class="" href="out-multi.html"><span class="header-section-number">23</span> Returning multiple values</a></li>
<li><a class="" href="out-type-stability.html"><span class="header-section-number">24</span> Type-stability</a></li>
<li><a class="" href="out-vectorisation.html"><span class="header-section-number">25</span> Vectorisation</a></li>
<li><a class="" href="out-invisible.html"><span class="header-section-number">26</span> Side-effect functions should return invisibly</a></li>
<li class="book-part">Interface: errors</li>
<li><a class="" href="err-call.html"><span class="header-section-number">27</span> Error call</a></li>
<li><a class="" href="err-constructor.html"><span class="header-section-number">28</span> Error constructors</a></li>
<li class="book-part">Interface: changes</li>
<li><a class="" href="changes-multivers.html"><span class="header-section-number">29</span> Work with multiple dependency versions</a></li>
<li class="book-part">Interface: side effects</li>
<li><a class="" href="side-effect-soup.html"><span class="header-section-number">30</span> Side-effect soup</a></li>
<li><a class="" href="spooky-action.html"><span class="header-section-number">31</span> Spooky action</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="glossary.html"><span class="header-section-number">A</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="http://github.com/tidyverse/design">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="names-attribute" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Names attribute<a class="anchor" aria-label="anchor" href="#names-attribute"><i class="fas fa-link"></i></a>
</h1>
<div id="coverage-in-tidyverse-style-guide" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Coverage in tidyverse style guide<a class="anchor" aria-label="anchor" href="#coverage-in-tidyverse-style-guide"><i class="fas fa-link"></i></a>
</h2>
<p>Existing name-related topics in <a href="http://style.tidyverse.org" class="uri">http://style.tidyverse.org</a></p>
<ul>
<li><a href="http://style.tidyverse.org/files.html#names">File names</a></li>
<li><a href="http://style.tidyverse.org/syntax.html#object-names">Object names</a></li>
<li><a href="http://style.tidyverse.org/syntax.html#argument-names">Argument names</a></li>
<li><a href="http://style.tidyverse.org/functions.html#naming">Function names</a></li>
</ul>
</div>
<div id="the-names-attribute-of-an-object" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> The <code>names</code> attribute of an object<a class="anchor" aria-label="anchor" href="#the-names-attribute-of-an-object"><i class="fas fa-link"></i></a>
</h2>
<p>Here we address how to manage the <code>names</code> attribute of an object. Our initial thinking was motivated by how to handle the column or variable names of a tibble, but is evolving into a name-handling strategy for vectors, in general.</p>
<p>The name repair described below is exposed to users via the <code>.name_repair</code> argument of <a href="https://tibble.tidyverse.org/reference/tibble.html">tibble::tibble()</a>, <a href="https://tibble.tidyverse.org/reference/as_tibble.html">tibble::as_tibble()</a>, <a href="https://readxl.tidyverse.org/reference/read_excel.html">readxl::read_excel()</a>, and, eventually other packages in the tidyverse. This work was initiated in the tibble package, but is migrating to the vctrs package. <em>Name repair was first introduced in <a href="https://tibble.tidyverse.org/news/index.html#tibble-2-0-0">tibble v2.0.0</a> and this write-up is being rendered with tibble v3.1.8 and vctrs v0.5.0.</em></p>
<p>These are the kind of names we’re talking about:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## variable names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ChickWeight</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "weight" "Time"   "Chick"  "Diet"</span></span>
<span></span>
<span><span class="co">## names along a vector</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">euro</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "ATS" "BEF" "DEM" "ESP" "FIM" "FRF" "IEP" "ITL" "LUF" "NLG" "PTE"</span></span></code></pre></div>
</div>
<div id="minimal-unique-universal" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Minimal, unique, universal<a class="anchor" aria-label="anchor" href="#minimal-unique-universal"><i class="fas fa-link"></i></a>
</h2>
<p>We identify three nested levels of naminess that are practically useful:</p>
<ul>
<li>Minimal: The <code>names</code> attribute is not <code>NULL</code>. The name of an unnamed element
is <code>""</code> (the empty string) and never <code>NA</code>.</li>
<li>Unique: No element of <code>names</code> appears more than once. A couple specific
names are also forbidden in unique names, such as <code>""</code> (the empty string).
<ul>
<li>All columns can be accessed by name via <code>df[["name"]]</code> and, more
generally, by quoting with backticks: <code>df$`name`</code>,
<code>subset(df, select = `name`)</code>, and <code>dplyr::select(df, `name`)</code>.</li>
</ul>
</li>
<li>Universal: The <code>names</code> are unique and syntactic.
<ul>
<li>Names work everywhere, without quoting: <code>df$name</code> and
<code>lm(name1 ~ name2, data = df)</code> and <code>dplyr::select(df, name)</code> all work.</li>
</ul>
</li>
</ul>
<p>Below we give more details and describe implementation.</p>
</div>
<div id="minimal-names" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Minimal names<a class="anchor" aria-label="anchor" href="#minimal-names"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Minimal</strong> names exist. The <code>names</code> attribute is not <code>NULL</code>. The name of an unnamed element is <code>""</code> (the empty string) and never <code>NA</code>.</p>
<p>Consider an unnamed vector, i.e. it has names attribute of <code>NULL</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Repair the names to make them minimal.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO: Figure out where `set_minimal_names()` ended up when name repair moved</span></span>
<span><span class="co"># from tibble to vctrs, then update this chunk. Use rlang in the meantime.</span></span>
<span></span>
<span><span class="co"># x &lt;- tibble:::set_minimal_names(x)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/names2.html">names2</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p>Minimal names appear to be a useful baseline requirement, if the <code>names</code> attribute of an object is going to be actively managed. Why? General name handling and repair can be implemented more simply if the baseline strategy guarantees that <code>names(x)</code> returns a character vector of the correct length with no <code>NA</code>s.</p>
<p>This is also a reasonable interpretation of base R’s <em>intent</em> for named vectors, based on the docs for <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/names.html"><code>names()</code></a>, although base R’s implementation/enforcement of this is uneven. From <code><a href="https://rdrr.io/r/base/names.html">?names</a></code>:</p>
<blockquote>
<p>The name <code>""</code> is special: it is used to indicate that there is no name
associated with an element of a (atomic or generic) vector. Subscripting by
<code>""</code> will match nothing (not even elements which have no name).</p>
<p>A name can be character <code>NA</code>, but such a name will never be matched and is
likely to lead to confusion.</p>
</blockquote>
<p><code>tbl_df</code> objects created by <a href="https://tibble.tidyverse.org/reference/tibble.html">tibble::tibble()</a> and <a href="https://tibble.tidyverse.org/reference/as_tibble.html">tibble::as_tibble()</a> have variable names that are minimal, at the very least.</p>
<p>The function <a href="https://rlang.r-lib.org/reference/names2.html">rlang::names2()</a> returns the names of an object, after making them minimal.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/names2.html">names2</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "" "" ""</span></span></code></pre></div>
</div>
<div id="unique-names" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Unique names<a class="anchor" aria-label="anchor" href="#unique-names"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Unique</strong> names meet the requirements for minimal and have no duplicates. In the tidyverse, we go further and repair a few specific names: <code>""</code> (the empty string), <code>...</code> (R’s ellipsis or “dots” construct), and <code>..j</code> where <code>j</code> is a number. They are basically all treated like <code>""</code>, which is always repaired.</p>
<p>Example of unique-ified names:</p>
<pre><code>original unique-ified
      ""         ...1
       x        x...2
      ""         ...3
     ...         ...4
       y            y
       x        x...6</code></pre>
<p>This augmented definition of unique has a specific motivation: it ensures that each element can be identified by name, at least when protected by backtick quotes. Literally, all of these work:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[[</span><span class="st">"name"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">`name`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">`name`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">df</span>, select <span class="op">=</span> <span class="va">`name`</span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">`name`</span><span class="op">)</span></span></code></pre></div>
<p>This has practical significance for variable names inside a data frame, because so many workflows rely on indexing by name. Note that uniqueness refers implicitly to a vector of names.</p>
<p>Let’s explore a few edge cases: A single dot followed by a number, <code>.j</code>, does not need repair.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>`.1` <span class="op">=</span> <span class="st">"ok"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">`.1`</span></span>
<span><span class="co">#&gt; [1] "ok"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">df</span>, select <span class="op">=</span> <span class="va">`.1`</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   `.1` </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 ok</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">`.1`</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   `.1` </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 ok</span></span></code></pre></div>
<p>Two dots followed by a number, <code>..j</code>, does need repair. The same goes for three dots, <code>...</code>, the ellipsis or “dots” construct. These can’t function as names, even if quoted with backticks, so they have to be repaired.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>`..1` <span class="op">=</span> <span class="st">"not ok"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error:</span></span>
<span><span class="co">#&gt; ! Column 1 must not have names of the form ... or ..j.</span></span>
<span><span class="co">#&gt; Use .name_repair to specify repair.</span></span>
<span><span class="co">#&gt; Caused by error in `repaired_names()`:</span></span>
<span><span class="co">#&gt; ! Names can't be of the form `...` or `..j`.</span></span>
<span><span class="co">#&gt; ✖ These names are invalid:</span></span>
<span><span class="co">#&gt;   * "..1" at location 1.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">`..1`</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(substitute(expr), data, enclos = parent.frame()): ..1 used in an incorrect context, no ... to look in</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">`..1`</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in dplyr::select(df, ..1): '...' used in an incorrect context</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>`...` <span class="op">=</span> <span class="st">"not ok"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error:</span></span>
<span><span class="co">#&gt; ! Column 1 must not have names of the form ... or ..j.</span></span>
<span><span class="co">#&gt; Use .name_repair to specify repair.</span></span>
<span><span class="co">#&gt; Caused by error in `repaired_names()`:</span></span>
<span><span class="co">#&gt; ! Names can't be of the form `...` or `..j`.</span></span>
<span><span class="co">#&gt; ✖ These names are invalid:</span></span>
<span><span class="co">#&gt;   * "..." at location 1.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">df</span>, select <span class="op">=</span> <span class="va">`...`</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): '...' used in an incorrect context</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">`...`</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): '...' used in an incorrect context</span></span></code></pre></div>
<p>Both are repaired as if they were <code>""</code>.</p>
<div id="making-names-unique" class="section level3" number="3.5.1">
<h3>
<span class="header-section-number">3.5.1</span> Making names unique<a class="anchor" aria-label="anchor" href="#making-names-unique"><i class="fas fa-link"></i></a>
</h3>
<p>There are many ways to make names unique. We append a suffix of the form <code>...j</code> to any name that is a duplicate or <code>""</code> or <code>...</code>, where <code>j</code> is the position. Why?</p>
<ul>
<li>An absolute position <code>j</code> is more helpful than numbering within the elements
that share a name. Context: troubleshooting data import with lots of columns
and dysfunctional names.</li>
<li>We hypothesize that it’s better have a “level playing field” when repairing
names, i.e. if <code>foo</code> appears twice, both instances get repaired, not just the
second occurrence.</li>
</ul>
<p>The unique level of naminess is regarded as normative for a tibble and a user must expressly request a tibble with names that violate this (but that is possible).</p>
<p>Base R’s function for this is <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/make.unique.html">make.unique()</a>. We revisit the example above, comparing the tidyverse strategy for making names unique vs. what <code><a href="https://rdrr.io/r/base/make.unique.html">make.unique()</a></code> does.</p>
<pre><code>Original Unique names     Result of
   names  (tidyverse) make.unique()
      ""         ...1            ""
       x        x...2             x
      ""         ...3            .1
     ...         ...4           ...
       y            y             y
       x        x...6           x.1</code></pre>
</div>
<div id="roundtrips" class="section level3" number="3.5.2">
<h3>
<span class="header-section-number">3.5.2</span> Roundtrips<a class="anchor" aria-label="anchor" href="#roundtrips"><i class="fas fa-link"></i></a>
</h3>
<p>When unique-ifying names, we assume that the input names have been repaired by the same strategy, i.e. that we are consuming dogfood. Therefore, pre-existing suffixes of the form <code>...j</code> are stripped, prior to (re-)constructing the suffixes. If this interacts poorly with your names, you need to take control of name repair.</p>
<p>Example of re-unique-ified names:</p>
<pre><code> original unique-ified
     ...5         ...1
        x        x...2
    x...3        x...3
       ""         ...4
x...1...5        x...5</code></pre>
<p><em>JB: it is conceivable that this should be under the control of an argument, e.g. <code>dogfood = TRUE</code>, in the (currently unexported) function that does this</em></p>
</div>
<div id="when-is-minimal-better-than-unique" class="section level3" number="3.5.3">
<h3>
<span class="header-section-number">3.5.3</span> When is minimal better than unique?<a class="anchor" aria-label="anchor" href="#when-is-minimal-better-than-unique"><i class="fas fa-link"></i></a>
</h3>
<p>Why would you ever want to import a tibble and enforce only minimal names, instead of unique? Sometimes the first row of a data source – allegedly variable names – actually contains <strong>data</strong> and the resulting tibble will be reshaped with, e.g., <code><a href="https://tidyr.tidyverse.org/reference/gather.html">tidyr::gather()</a></code>. In this case, it is better to not munge the names at import. This is a common special case of the “data stored in names” phenomenon.</p>
<p>In general, you may want to tolerate minimal names when the dysfunctional names are just an awkward phase that an object is passing through and a more definitive solution is applied downstream.</p>
</div>
<div id="ugly-with-a-purpose" class="section level3" number="3.5.4">
<h3>
<span class="header-section-number">3.5.4</span> Ugly, with a purpose<a class="anchor" aria-label="anchor" href="#ugly-with-a-purpose"><i class="fas fa-link"></i></a>
</h3>
<p>You might say that names like <code>x...5</code> are ugly and you would be right. We’re calling this a feature, not a bug! Names that have been automatically unique-ified by the tidyverse should catch the eye and give the user strong encouragement to take charge of the situation.</p>
</div>
<div id="why-so-many-dots" class="section level3" number="3.5.5">
<h3>
<span class="header-section-number">3.5.5</span> Why so many dots?<a class="anchor" aria-label="anchor" href="#why-so-many-dots"><i class="fas fa-link"></i></a>
</h3>
<p>The suffix of <code>...j</code>, with 3 leading dots, is the result of jointly satisfying multiple requirements. It is important to anticipate a missing name, where the suffix becomes the entire name. We have elected to make the suffix a syntactic name (more below), because non-syntactic names are a frequent cause of unexpected friction for users. This means the suffix can’t be <code>j</code>, <code>.j</code>, or <code>..j</code>, because all are non-syntactic. It must be <code>...j</code>.</p>
</div>
<div id="why-dots-in-the-first-place" class="section level3" number="3.5.6">
<h3>
<span class="header-section-number">3.5.6</span> Why dot(s) in the first place?<a class="anchor" aria-label="anchor" href="#why-dots-in-the-first-place"><i class="fas fa-link"></i></a>
</h3>
<p>The underscore <code>_</code> was also considered when choosing the suffix strategy, but was rejected. Why? Because syntactic names can’t start with an underscore and we want the suffix itself to be syntactic. Also, the dot <code>.</code> is already used by base R’s <code><a href="https://rdrr.io/r/base/make.names.html">make.names()</a></code> to replace invalid characters. It seems simpler and, therefore, better to use the same character, in the same way, as much as possible in name repair. We use the dot <code>.</code>, we put it at the front, as many times as necessary.</p>
</div>
</div>
<div id="universal-names" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Universal names<a class="anchor" aria-label="anchor" href="#universal-names"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Universal</strong> names are <strong>unique</strong>, in the sense described above, and <strong>syntactic</strong>, in the normal R sense. Universal names are appealing because they play nicely with base R and tidyverse functions that accept unquoted variable names.</p>
<div id="syntactic-names" class="section level3" number="3.6.1">
<h3>
<span class="header-section-number">3.6.1</span> Syntactic names<a class="anchor" aria-label="anchor" href="#syntactic-names"><i class="fas fa-link"></i></a>
</h3>
<p>A syntactic name in R:</p>
<ul>
<li>Consists of letters, numbers, and the dot <code>.</code> or underscore <code>_</code> characters.</li>
<li>Starts with a letter or starts with a dot <code>.</code> followed by anything but a
number.</li>
<li>Is not a reserved word, such as <code>if</code> or <code>function</code> or <code>TRUE</code>.</li>
<li>Is not <code>...</code>, R’s special ellipsis or “dots” construct.</li>
<li>Is not of the form <code>..j</code>, where <code>j</code> is a number.</li>
</ul>
<p>See R’s documentation for <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/Reserved.html">Reserved words</a> and <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/Quotes.html">Quotes</a>, specifically the section on names and identifiers.</p>
<p>A syntactic name can be used “as is” in code. For example, it does not require quoting in order to work with non-standard evaluation, such as list indexing via <code>$</code>, in a formula, or in packages like dplyr and ggplot2.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## a syntactic name doesn't require quoting</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>.else <span class="op">=</span> <span class="st">"else?!"</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">.else</span></span>
<span><span class="co">#&gt; [1] "else?!"</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">.else</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   .else </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 else?!</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## use a non-syntactic name</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>`else` <span class="op">=</span> <span class="st">"else?!"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## this code does not parse</span></span>
<span><span class="co"># x$else</span></span>
<span><span class="co"># dplyr::select(x, else)</span></span>
<span></span>
<span><span class="co">## a non-syntacitic name requires quoting</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">`else`</span></span>
<span><span class="co">#&gt; [1] "else?!"</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">`else`</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   `else`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 else?!</span></span></code></pre></div>
<p>Note that being syntactic is a property of an individual name.</p>
</div>
<div id="making-an-individual-name-syntactic" class="section level3" number="3.6.2">
<h3>
<span class="header-section-number">3.6.2</span> Making an individual name syntactic<a class="anchor" aria-label="anchor" href="#making-an-individual-name-syntactic"><i class="fas fa-link"></i></a>
</h3>
<p>There are many ways to fix a non-syntactic name. Here’s how our logic compares to <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/make.names.html">base::make.names()</a> for a single name:</p>
<ul>
<li>Same: Definition of what is syntactically valid.
<ul>
<li>Claim: If <code>syn_name</code> is a name that we have made syntactic, then
<code>syn_name == make.names(syn_name)</code>. If you find a counterexample, tell us!</li>
</ul>
</li>
<li>Same: An invalid character is replaced with a dot <code>.</code>.</li>
<li>Different: We always fix a name by prepending a dot <code>.</code>. <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/make.names.html">base::make.names()</a>
sometimes prefixes with <code>X</code> and at other times appends a dot <code>.</code>.
<ul>
<li>This means we turn <code>...</code> into <code>....</code> and <code>..j</code> into <code>...j</code>, where <code>j</code> is a
number. <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/make.names.html">base::make.names()</a> does not modify <code>...</code> or <code>..j</code>, which could be
regarded as a bug (?).</li>
</ul>
</li>
<li>Different: We treat <code>NA</code> and <code>""</code> the same: both become <code>.</code>. This is because
we first make names minimal. <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/make.names.html">base::make.names()</a> turns <code>NA</code> into <code>"NA."</code> and <code>""</code> into <code>"X"</code>.</li>
</ul>
<p>Examples of the tidyverse approach to making individual names syntactic versus <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/make.names.html"><code>base::make.names()</code></a>:</p>
<pre><code>Original Syntactic name    Result of
    name    (tidyverse) make.names()
      ""              .            X
      NA              .          NA.
     (y)            .y.         X.y.
      _z            ._z          X_z
    .2fa          ..2fa        X.2fa
   FALSE         .FALSE       FALSE.
     ...           ....          ...
     ..3           ...3          ..3</code></pre>
<!-- FIXME? point out the non-syntactic names returned by make.names() -->
<p>Currently implemented in the unexported function <code>tibble:::make_syntactic()</code>.</p>
</div>
<div id="why-universal" class="section level3" number="3.6.3">
<h3>
<span class="header-section-number">3.6.3</span> Why universal?<a class="anchor" aria-label="anchor" href="#why-universal"><i class="fas fa-link"></i></a>
</h3>
<p>Now we can state the motivation for universal names, which have the group-wise property of being unique and the element-wise property of being syntactic.</p>
<p>In practice, if you want syntactic names, you probably also want them to be unique. You need both in order to refer to individual elements easily, without ambiguity and without quoting.</p>
<p>Universal names can be requested in the tidyverse via <code>.name_repair = "universal"</code>, in functions that expose name repair.</p>
</div>
<div id="making-names-universal" class="section level3" number="3.6.4">
<h3>
<span class="header-section-number">3.6.4</span> Making names universal<a class="anchor" aria-label="anchor" href="#making-names-universal"><i class="fas fa-link"></i></a>
</h3>
<p>Universal names are implemented as a variation on unique names. Basically, suffixes are stripped and <code>...</code> is replaced with <code>""</code>. These draft names are transformed with <code>tibble:::make_syntactic()</code> (this step is omitted for unique names). Then <code>...j</code> suffixes are appended as necessary.</p>
<p>Note that suffix stripping and the substitution of <code>""</code> for <code>...</code> happens before the draft names are made syntactic. So, although <code>tibble:::make_syntactic</code> turns <code>...</code> into <code>....</code>, universal or unique name repair will turn <code>...</code> into something of the form <code>...j</code>.</p>
</div>
</div>
<div id="messaging-user-about-name-repair" class="section level2" number="3.7">
<h2>
<span class="header-section-number">3.7</span> Messaging user about name repair<a class="anchor" aria-label="anchor" href="#messaging-user-about-name-repair"><i class="fas fa-link"></i></a>
</h2>
<p>Name repair should be communicated to the user. Here’s how tibble messages:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1</span>, x <span class="op">=</span> <span class="fl">2</span>, `a1:` <span class="op">=</span> <span class="fl">3</span>, `_x_y}` <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  .name_repair <span class="op">=</span> <span class="st">"universal"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; • `x` -&gt; `x...1`</span></span>
<span><span class="co">#&gt; • `x` -&gt; `x...2`</span></span>
<span><span class="co">#&gt; • `a1:` -&gt; `a1.`</span></span>
<span><span class="co">#&gt; • `_x_y}` -&gt; `._x_y.`</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="unifying-principles.html"><span class="header-section-number">2</span> Unifying principles</a></div>
<div class="next"><a href="call-data-details.html"><span class="header-section-number">4</span> Name details arguments</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#names-attribute"><span class="header-section-number">3</span> Names attribute</a></li>
<li><a class="nav-link" href="#coverage-in-tidyverse-style-guide"><span class="header-section-number">3.1</span> Coverage in tidyverse style guide</a></li>
<li><a class="nav-link" href="#the-names-attribute-of-an-object"><span class="header-section-number">3.2</span> The names attribute of an object</a></li>
<li><a class="nav-link" href="#minimal-unique-universal"><span class="header-section-number">3.3</span> Minimal, unique, universal</a></li>
<li><a class="nav-link" href="#minimal-names"><span class="header-section-number">3.4</span> Minimal names</a></li>
<li>
<a class="nav-link" href="#unique-names"><span class="header-section-number">3.5</span> Unique names</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#making-names-unique"><span class="header-section-number">3.5.1</span> Making names unique</a></li>
<li><a class="nav-link" href="#roundtrips"><span class="header-section-number">3.5.2</span> Roundtrips</a></li>
<li><a class="nav-link" href="#when-is-minimal-better-than-unique"><span class="header-section-number">3.5.3</span> When is minimal better than unique?</a></li>
<li><a class="nav-link" href="#ugly-with-a-purpose"><span class="header-section-number">3.5.4</span> Ugly, with a purpose</a></li>
<li><a class="nav-link" href="#why-so-many-dots"><span class="header-section-number">3.5.5</span> Why so many dots?</a></li>
<li><a class="nav-link" href="#why-dots-in-the-first-place"><span class="header-section-number">3.5.6</span> Why dot(s) in the first place?</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#universal-names"><span class="header-section-number">3.6</span> Universal names</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#syntactic-names"><span class="header-section-number">3.6.1</span> Syntactic names</a></li>
<li><a class="nav-link" href="#making-an-individual-name-syntactic"><span class="header-section-number">3.6.2</span> Making an individual name syntactic</a></li>
<li><a class="nav-link" href="#why-universal"><span class="header-section-number">3.6.3</span> Why universal?</a></li>
<li><a class="nav-link" href="#making-names-universal"><span class="header-section-number">3.6.4</span> Making names universal</a></li>
</ul>
</li>
<li><a class="nav-link" href="#messaging-user-about-name-repair"><span class="header-section-number">3.7</span> Messaging user about name repair</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="http://github.com/tidyverse/design/blob/main/names.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="http://github.com/tidyverse/design/edit/main/names.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Tidyverse design guide</strong>" was written by Tidyverse team. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
