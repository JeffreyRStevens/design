<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>13 Avoid magical defaults | Tidyverse design guide</title>
<meta name="author" content="Tidyverse team">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="13 Avoid magical defaults | Tidyverse design guide">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="13 Avoid magical defaults | Tidyverse design guide">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115082821-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="13.1 What’s the problem? If a function behaves differently when the default value is supplied explicitly, we say it has a magical default. Magical defaults are best avoided because they make it...">
<meta property="og:description" content="13.1 What’s the problem? If a function behaves differently when the default value is supplied explicitly, we say it has a magical default. Magical defaults are best avoided because they make it...">
<meta name="twitter:description" content="13.1 What’s the problem? If a function behaves differently when the default value is supplied explicitly, we say it has a magical default. Magical defaults are best avoided because they make it...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Tidyverse design guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="structure.html"><span class="header-section-number">1</span> Structure</a></li>
<li><a class="" href="unifying-principles.html"><span class="header-section-number">2</span> Unifying principles</a></li>
<li class="book-part">Implementation</li>
<li><a class="" href="names-attribute.html"><span class="header-section-number">3</span> Names attribute</a></li>
<li><a class="" href="call-data-details.html"><span class="header-section-number">4</span> Name details arguments</a></li>
<li><a class="" href="function-names.html"><span class="header-section-number">5</span> Function names</a></li>
<li class="book-part">Interface: inputs</li>
<li><a class="" href="args-hidden.html"><span class="header-section-number">6</span> Avoid hidden arguments</a></li>
<li><a class="" href="args-data-details.html"><span class="header-section-number">7</span> Data, descriptors, details</a></li>
<li><a class="" href="args-independence.html"><span class="header-section-number">8</span> Avoid dependencies between arguments</a></li>
<li><a class="" href="case-study-setnames.html"><span class="header-section-number">9</span> Case study: setNames()</a></li>
<li class="book-part">Interface: default values</li>
<li><a class="" href="def-required.html"><span class="header-section-number">10</span> Required args shouldn’t have defaults</a></li>
<li><a class="" href="cs-rep.html"><span class="header-section-number">11</span> Case study: rep()</a></li>
<li><a class="" href="def-enum.html"><span class="header-section-number">12</span> Enumerate possible options</a></li>
<li><a class="active" href="def-magical.html"><span class="header-section-number">13</span> Avoid magical defaults</a></li>
<li><a class="" href="def-short.html"><span class="header-section-number">14</span> Keep defaults short and sweet</a></li>
<li><a class="" href="def-inform.html"><span class="header-section-number">15</span> Explain important defaults</a></li>
<li><a class="" href="def-user.html"><span class="header-section-number">16</span> User settable defaults</a></li>
<li><a class="" href="cs-rgb.html"><span class="header-section-number">17</span> Case study: rgb()</a></li>
<li class="book-part">Interface: ...</li>
<li><a class="" href="dots-position.html"><span class="header-section-number">18</span> Data, dots, details</a></li>
<li><a class="" href="dots-data.html"><span class="header-section-number">19</span> Making data with …</a></li>
<li><a class="" href="dots-prefix.html"><span class="header-section-number">20</span> Dot prefix</a></li>
<li><a class="" href="dots-inspect.html"><span class="header-section-number">21</span> Inspect the dots</a></li>
<li><a class="" href="cs-mapply-pmap.html"><span class="header-section-number">22</span> Case study: mapply() vs pmap()</a></li>
<li class="book-part">Interface: outputs</li>
<li><a class="" href="out-multi.html"><span class="header-section-number">23</span> Returning multiple values</a></li>
<li><a class="" href="out-type-stability.html"><span class="header-section-number">24</span> Type-stability</a></li>
<li><a class="" href="out-vectorisation.html"><span class="header-section-number">25</span> Vectorisation</a></li>
<li><a class="" href="out-invisible.html"><span class="header-section-number">26</span> Side-effect functions should return invisibly</a></li>
<li class="book-part">Interface: errors</li>
<li><a class="" href="err-call.html"><span class="header-section-number">27</span> Error call</a></li>
<li><a class="" href="err-constructor.html"><span class="header-section-number">28</span> Error constructors</a></li>
<li class="book-part">Interface: changes</li>
<li><a class="" href="changes-multivers.html"><span class="header-section-number">29</span> Work with multiple dependency versions</a></li>
<li class="book-part">Interface: side effects</li>
<li><a class="" href="side-effect-soup.html"><span class="header-section-number">30</span> Side-effect soup</a></li>
<li><a class="" href="spooky-action.html"><span class="header-section-number">31</span> Spooky action</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="glossary.html"><span class="header-section-number">A</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="http://github.com/tidyverse/design">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="def-magical" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Avoid magical defaults<a class="anchor" aria-label="anchor" href="#def-magical"><i class="fas fa-link"></i></a>
</h1>
<div id="whats-the-problem-3" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> What’s the problem?<a class="anchor" aria-label="anchor" href="#whats-the-problem-3"><i class="fas fa-link"></i></a>
</h2>
<p>If a function behaves differently when the default value is supplied explicitly, we say it has a <strong>magical default</strong>. Magical defaults are best avoided because they make it harder to interpret the function specification.</p>
</div>
<div id="what-are-some-examples-5" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> What are some examples?<a class="anchor" aria-label="anchor" href="#what-are-some-examples-5"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>In <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>, the default argument for <code>row.names</code> is <code>NULL</code>, but
if you supply it directly you get a different result:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fun_call</span><span class="op">(</span><span class="va">data.frame</span><span class="op">)</span></span>
<span><span class="co">#&gt; base::data.frame(..., row.names = NULL, check.rows = FALSE, check.names = TRUE, </span></span>
<span><span class="co">#&gt;     fix.empty.names = TRUE, stringsAsFactors = FALSE)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>nm <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x</span></span>
<span><span class="co">#&gt; a a</span></span>
<span><span class="co">#&gt; b b</span></span>
<span><span class="co">#&gt; c c</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x</span></span>
<span><span class="co">#&gt; 1 a</span></span>
<span><span class="co">#&gt; 2 b</span></span>
<span><span class="co">#&gt; 3 c</span></span></code></pre></div>
</li>
<li>
<p>In <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code>, the default value of <code>xlim</code> is <code>range(breaks)</code>, and the
default value for <code>breaks</code> is <code>"Sturges"</code>. <code>range("Sturges")</code> returns
<code>c("Sturges", "Sturges")</code> which doesn’t work when supplied explicitly:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fun_call</span><span class="op">(</span><span class="va">hist.default</span><span class="op">)</span></span>
<span><span class="co">#&gt; graphics::hist.default(x, breaks = "Sturges", freq = NULL, probability = !freq, </span></span>
<span><span class="co">#&gt;     include.lowest = TRUE, right = TRUE, fuzz = 1e-07, density = NULL, </span></span>
<span><span class="co">#&gt;     angle = 45, col = "lightgray", border = NULL, main = paste("Histogram of", </span></span>
<span><span class="co">#&gt;         xname), xlim = range(breaks), ylim = NULL, xlab = xname, </span></span>
<span><span class="co">#&gt;     ylab, axes = TRUE, plot = TRUE, labels = FALSE, nclass = NULL, </span></span>
<span><span class="co">#&gt;     warn.unused = TRUE, ...)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sturges"</span>, <span class="st">"Sturges"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in plot.window(xlim, ylim, "", ...): invalid 'xlim' value</span></span></code></pre></div>
</li>
<li>
<p>In <code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code>, the default argument for <code>vectorize.args</code> is <code>arg.names</code>,
but this variable is defined inside of <code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code>, so if you supply it
explicitly you get an error.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fun_call</span><span class="op">(</span><span class="va">Vectorize</span><span class="op">)</span></span>
<span><span class="co">#&gt; base::Vectorize(FUN, vectorize.args = arg.names, SIMPLIFY = TRUE, </span></span>
<span><span class="co">#&gt;     USE.NAMES = TRUE)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize</a></span><span class="op">(</span><span class="va">rep.int</span>, vectorize.args <span class="op">=</span> <span class="va">arg.names</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in Vectorize(rep.int, vectorize.args = arg.names): object 'arg.names' not found</span></span></code></pre></div>
</li>
<li>
<p>In <code><a href="https://rdrr.io/r/stats/Beta.html">rbeta()</a></code>, the default value of <code>ncp</code> is 0, but if you explicitly supply
it the function uses a different algorithm:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rbeta</span></span>
<span><span class="co">#&gt; function (n, shape1, shape2, ncp = 0) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (missing(ncp)) </span></span>
<span><span class="co">#&gt;         .Call(C_rbeta, n, shape1, shape2)</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         X &lt;- rchisq(n, 2 * shape1, ncp = ncp)</span></span>
<span><span class="co">#&gt;         X/(X + rchisq(n, 2 * shape2))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55f37b5aa310&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:stats&gt;</span></span></code></pre></div>
</li>
<li><p>In <code><a href="https://rdrr.io/r/base/table.html">table()</a></code>, the default value of <code>dnn</code> is <code>list.names(...)</code>; but
<code>list.names()</code> is only defined inside of <code><a href="https://rdrr.io/r/base/table.html">table()</a></code>.</p></li>
<li>
<p><code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv()</a></code> has <code>progress = show_progress()</code>, but until version
1.3.1, <code>show_progress()</code> was not exported from the package. That means if you
attempted to run it yourself, you’d see an error message:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show_progress</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in show_progress(): could not find function "show_progress"</span></span></code></pre></div>
</li>
<li><p>In <code>usethis::use_rmarkdown_template()</code>, <code>template_dir</code> has the default value
of <code>tolower(asciify(template_name))</code>, but <code>asciify</code> is not exported. That
means there’s no way to interactively explore this default value.</p></li>
</ul>
</div>
<div id="what-are-the-exceptions-2" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> What are the exceptions?<a class="anchor" aria-label="anchor" href="#what-are-the-exceptions-2"><i class="fas fa-link"></i></a>
</h2>
<p>It’s ok to use this behaviour when you want the default value of one argument to be the same as another. For example, take <code><a href="https://rlang.r-lib.org/reference/set_names.html">rlang::set_names()</a></code>, which allows you to create a named vector from two inputs:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fun_call</span><span class="op">(</span><span class="va">set_names</span><span class="op">)</span></span>
<span><span class="co">#&gt; rlang::set_names(x, nm = x, ...)</span></span>
<span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; a b c </span></span>
<span><span class="co">#&gt; 1 2 3</span></span></code></pre></div>
<p>The default value for the names is the vector itself. This provides a convenient shortcut for naming a vector with itself:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set_names</span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   a   b   c </span></span>
<span><span class="co">#&gt; "a" "b" "c"</span></span></code></pre></div>
<p>You can see this same technique in <code><a href="https://rdrr.io/r/base/merge.html">merge()</a></code>, where <code>all.x</code> and <code>all.y</code> default to the same value as <code>all</code>, and in <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> where <code>labels</code> defaults to the same value as <code>levels</code>.</p>
<p>If you use this technique, make sure that you never use the value of an argument that comes later in the argument list. For example, in <code><a href="https://rdrr.io/r/base/files.html">file.copy()</a></code> <code>overwrite</code> defaults to the same value as <code>recursive</code>, but the <code>recursive</code> argument is defined after <code>overwrite</code>:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fun_call</span><span class="op">(</span><span class="va">file.copy</span><span class="op">)</span></span>
<span><span class="co">#&gt; base::file.copy(from, to, overwrite = recursive, recursive = FALSE, </span></span>
<span><span class="co">#&gt;     copy.mode = TRUE, copy.date = FALSE)</span></span></code></pre></div>
<p>This makes the defaults arguments harder to understand because you can’t just read from left-to-right.</p>
</div>
<div id="what-causes-the-problem" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> What causes the problem?<a class="anchor" aria-label="anchor" href="#what-causes-the-problem"><i class="fas fa-link"></i></a>
</h2>
<p>There are three primary causes:</p>
<ul>
<li>
<p>Overuse of lazy evaluation of default values, which are evaluated in the
environment of the function, as described in
<a href="https://adv-r.hadley.nz/functions.html#default-arguments">Advanced R</a>.
Here’s a simple example:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu">f1</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2022-11-01 UTC"</span></span>
<span><span class="fu">f1</span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>When <code>x</code> takes the value <code>y</code> from its default, it’s evaluated inside the
function, yielding <code>1</code>. When <code>y</code> is supplied explicitly, it is evaluated
in the caller environment, yielding <code>2</code>.</p>
</li>
<li>
<p>Use of <code><a href="https://rdrr.io/r/base/missing.html">missing()</a></code> so that the default value is never consulted:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html">missing</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fl">2</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">x</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">f2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="fu">f2</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
</li>
<li><p>In packages, it’s easy to use a non-exported function without thinking
about it. This function is available to you, the package author, but not
the user of the package, which makes it harder for them to understand
how a package works.</p></li>
</ul>
</div>
<div id="how-do-i-remediate-the-problem" class="section level2" number="13.5">
<h2>
<span class="header-section-number">13.5</span> How do I remediate the problem?<a class="anchor" aria-label="anchor" href="#how-do-i-remediate-the-problem"><i class="fas fa-link"></i></a>
</h2>
<p>This problem is generally easy to avoid for new functions:</p>
<ul>
<li><p>Don’t use default values that depend on variables defined inside the function.</p></li>
<li><p>Don’t use <code><a href="https://rdrr.io/r/base/missing.html">missing()</a></code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The only exceptions are described in Sections &lt;a href="def-required.html#args-mutually-exclusive"&gt;10.3.1&lt;/a&gt; and &lt;a href="def-required.html#args-compound"&gt;10.3.2&lt;/a&gt;.&lt;/p&gt;'><sup>4</sup></a>.</p></li>
<li><p>Don’t use unexported functions.</p></li>
</ul>
<p>If you have a made a mistake in an older function you can remediate it by using a <code>NULL</code> default, as described in Chapter <a href="def-short.html#def-short">14</a>. If the problem is caused by an unexported function, you can also choose to document and export it.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">`%||%`</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="va">y</span> <span class="kw">else</span> <span class="va">x</span></span>
<span></span>
<span><span class="va">f1_better</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">%||%</span> <span class="va">y</span></span>
<span>  </span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">f2_better</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">%||%</span> <span class="fl">2</span></span>
<span>  </span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This modification should not break existing code, because expands the function interface: all previous code will continue to work, and the function will also work if the argument is passed <code>NULL</code> input (which probably didn’t previously).</p>
<p>For functions like <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> where <code>NULL</code> is already a permissible value, you’ll need to use a sentinel object, as described in Section <a href="def-short.html#args-default-sentinel">14.4.3</a>.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sentinel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"sentinel"</span><span class="op">)</span></span>
<span><span class="va">is_sentinel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"sentinel"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data.frame_better</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">row.names</span> <span class="op">=</span> <span class="fu">sentinel</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">is_sentinel</span><span class="op">(</span><span class="va">row.names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># old default behaviour</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="def-enum.html"><span class="header-section-number">12</span> Enumerate possible options</a></div>
<div class="next"><a href="def-short.html"><span class="header-section-number">14</span> Keep defaults short and sweet</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#def-magical"><span class="header-section-number">13</span> Avoid magical defaults</a></li>
<li><a class="nav-link" href="#whats-the-problem-3"><span class="header-section-number">13.1</span> What’s the problem?</a></li>
<li><a class="nav-link" href="#what-are-some-examples-5"><span class="header-section-number">13.2</span> What are some examples?</a></li>
<li><a class="nav-link" href="#what-are-the-exceptions-2"><span class="header-section-number">13.3</span> What are the exceptions?</a></li>
<li><a class="nav-link" href="#what-causes-the-problem"><span class="header-section-number">13.4</span> What causes the problem?</a></li>
<li><a class="nav-link" href="#how-do-i-remediate-the-problem"><span class="header-section-number">13.5</span> How do I remediate the problem?</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="http://github.com/tidyverse/design/blob/main/def-magical.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="http://github.com/tidyverse/design/edit/main/def-magical.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Tidyverse design guide</strong>" was written by Tidyverse team. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
