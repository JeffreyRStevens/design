# Show possible options {#args-enum}

```{r, include = FALSE}
source("common.R")
```

## What's the pattern?

If an argument can take one of a relatively small set of known values, specify all possible values in the default argument, and then use `match.arg()` or `rlang::arg_match()` to pick. This patter is often naturally paired with a `switch()` to take action.

(See ???? for a similar pattern that can be extended by others.)

## Where is it used?

You can see an example of this in the `rank()` function. It has a `ties.method` that describes the method used to handle the rank of ties. It must be "average", "first", "last", "random", "max", or "min". `rank()` documents this restriction with the by including a vector of possible values as the default.

```{r}
rank <- function(x, 
                 ties.method = 
                  c("average", "first", "last", "random", "max", "min")
                 ) {
  
  ties.method <- match.arg(ties.method)
  
  switch(ties.method, 
    average = , 
    min = , 
    max = .Internal(rank(x, length(x), ties.method)), 
    first = sort.list(sort.list(x)),
    last = sort.list(rev.default(sort.list(x, decreasing = TRUE))), 
    random = sort.list(order(x, stats::runif(length(x))))
  )
}

x <- c(1, 2, 2, 3, 3, 3)

rank(x)
rank(x, ties.method = "first")
rank(x, ties.method = "min")
```

Note that `match.arg()` will automatically throw an error if the value is not in the set:

```{r, error = TRUE}
rank(x, ties.method = "middle")
```

It also supports partial matching so that the following code is shorthand for `ties.method = "random":

```{r}
rank(x, ties.method = "r")
```

We generally believe that partial matching is a bad idea, because it makes code harder to read. `rlang::arg_match()` is an alternative to `match.args()` that doesn't support partial matching. Instead it provides a helpful error message:

```{r, error = TRUE}
rank2 <- function(x, 
                 ties.method = 
                  c("average", "first", "last", "random", "max", "min")
                 ) {
  
  ties.method <- rlang::arg_match(ties.method)
  rank(x, ties.method = ties.method)
}

rank2(x, ties.method = "r")
```

## When to avoid it?

Best used when the set of possible values is short. You can see in the `rank()` example it's already getting unwieldy and makes it difficult to nicely format. Instead, you can set the `default` value to `NULL` and use the second argument of `arg_match()` or `match.arg()`

```{r}
rank2 <- function(x, ties.method = NULL) {

  ties.method <- rlang::arg_match(
    ties.method,
    c("average", "first", "last", "random", "max", "min")
  )
  rank(x, ties.method = ties.method)
}
```

You will need to make sure to carefully document the options as they will no longer be directly visible in the formals.
