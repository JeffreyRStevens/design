<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>9 Case study: setNames() | Tidyverse design guide</title>
<meta name="author" content="Tidyverse team">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="9 Case study: setNames() | Tidyverse design guide">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="9 Case study: setNames() | Tidyverse design guide">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115082821-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="9.1 What does setNames() do? stats::setNames() is a shorthand that allows you to set vector names inline (it’s a little surprising that it lives in the stats package). It has a simple definition:...">
<meta property="og:description" content="9.1 What does setNames() do? stats::setNames() is a shorthand that allows you to set vector names inline (it’s a little surprising that it lives in the stats package). It has a simple definition:...">
<meta name="twitter:description" content="9.1 What does setNames() do? stats::setNames() is a shorthand that allows you to set vector names inline (it’s a little surprising that it lives in the stats package). It has a simple definition:...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Tidyverse design guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="structure.html"><span class="header-section-number">1</span> Structure</a></li>
<li><a class="" href="unifying-principles.html"><span class="header-section-number">2</span> Unifying principles</a></li>
<li class="book-part">Implementation</li>
<li><a class="" href="names-attribute.html"><span class="header-section-number">3</span> Names attribute</a></li>
<li><a class="" href="call-data-details.html"><span class="header-section-number">4</span> Name details arguments</a></li>
<li><a class="" href="function-names.html"><span class="header-section-number">5</span> Function names</a></li>
<li class="book-part">Interface: inputs</li>
<li><a class="" href="args-hidden.html"><span class="header-section-number">6</span> Avoid hidden arguments</a></li>
<li><a class="" href="args-data-details.html"><span class="header-section-number">7</span> Data, descriptors, details</a></li>
<li><a class="" href="args-independence.html"><span class="header-section-number">8</span> Avoid dependencies between arguments</a></li>
<li><a class="active" href="case-study-setnames.html"><span class="header-section-number">9</span> Case study: setNames()</a></li>
<li class="book-part">Interface: default values</li>
<li><a class="" href="def-required.html"><span class="header-section-number">10</span> Required args shouldn’t have defaults</a></li>
<li><a class="" href="cs-rep.html"><span class="header-section-number">11</span> Case study: rep()</a></li>
<li><a class="" href="def-enum.html"><span class="header-section-number">12</span> Enumerate possible options</a></li>
<li><a class="" href="def-magical.html"><span class="header-section-number">13</span> Avoid magical defaults</a></li>
<li><a class="" href="def-short.html"><span class="header-section-number">14</span> Keep defaults short and sweet</a></li>
<li><a class="" href="def-inform.html"><span class="header-section-number">15</span> Explain important defaults</a></li>
<li><a class="" href="def-user.html"><span class="header-section-number">16</span> User settable defaults</a></li>
<li><a class="" href="cs-rgb.html"><span class="header-section-number">17</span> Case study: rgb()</a></li>
<li class="book-part">Interface: ...</li>
<li><a class="" href="dots-position.html"><span class="header-section-number">18</span> Data, dots, details</a></li>
<li><a class="" href="dots-data.html"><span class="header-section-number">19</span> Making data with …</a></li>
<li><a class="" href="dots-prefix.html"><span class="header-section-number">20</span> Dot prefix</a></li>
<li><a class="" href="dots-inspect.html"><span class="header-section-number">21</span> Inspect the dots</a></li>
<li><a class="" href="cs-mapply-pmap.html"><span class="header-section-number">22</span> Case study: mapply() vs pmap()</a></li>
<li class="book-part">Interface: outputs</li>
<li><a class="" href="out-multi.html"><span class="header-section-number">23</span> Returning multiple values</a></li>
<li><a class="" href="out-type-stability.html"><span class="header-section-number">24</span> Type-stability</a></li>
<li><a class="" href="out-vectorisation.html"><span class="header-section-number">25</span> Vectorisation</a></li>
<li><a class="" href="out-invisible.html"><span class="header-section-number">26</span> Side-effect functions should return invisibly</a></li>
<li class="book-part">Interface: errors</li>
<li><a class="" href="err-call.html"><span class="header-section-number">27</span> Error call</a></li>
<li><a class="" href="err-constructor.html"><span class="header-section-number">28</span> Error constructors</a></li>
<li class="book-part">Interface: changes</li>
<li><a class="" href="changes-multivers.html"><span class="header-section-number">29</span> Work with multiple dependency versions</a></li>
<li class="book-part">Interface: side effects</li>
<li><a class="" href="side-effect-soup.html"><span class="header-section-number">30</span> Side-effect soup</a></li>
<li><a class="" href="spooky-action.html"><span class="header-section-number">31</span> Spooky action</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="glossary.html"><span class="header-section-number">A</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="http://github.com/tidyverse/design">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="case-study-setnames" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Case study: <code>setNames()</code><a class="anchor" aria-label="anchor" href="#case-study-setnames"><i class="fas fa-link"></i></a>
</h1>
<div id="what-does-setnames-do" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> What does <code>setNames()</code> do?<a class="anchor" aria-label="anchor" href="#what-does-setnames-do"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/r/stats/setNames.html">stats::setNames()</a></code> is a shorthand that allows you to set vector names inline (it’s a little surprising that it lives in the stats package). It has a simple definition:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setNames</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span> <span class="op">=</span> <span class="va">nm</span>, <span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nm</span></span>
<span>  <span class="va">object</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And is easy to use:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Instead of</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Can write</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; a b c </span></span>
<span><span class="co">#&gt; 1 2 3</span></span></code></pre></div>
<p>This function is short (just two lines of code!) but yields a surprisingly rich analysis.</p>
</div>
<div id="how-can-we-improve-the-names" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> How can we improve the names?<a class="anchor" aria-label="anchor" href="#how-can-we-improve-the-names"><i class="fas fa-link"></i></a>
</h2>
<p>Firstly, I prefer snake_case to camelCase, so I’d call the function <code>set_names()</code>. Then we need to consider the arguments:</p>
<ul>
<li><p>I think the first argument, <code>object</code>, would be better called <code>x</code> in order
to emphasise that this function only works with vectors (because only
vectors have names).</p></li>
<li><p>The second argument, <code>nm</code> is rather terse, and I don’t see any disadvantage
in calling it <code>names</code>. I think you could also argue that it should be
called <code>y</code> since its meaning should be obvious from the function name.</p></li>
</ul>
<p>This yields:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> <span class="op">=</span> <span class="va">names</span>, <span class="va">names</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="what-about-the-default-values" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> What about the default values?<a class="anchor" aria-label="anchor" href="#what-about-the-default-values"><i class="fas fa-link"></i></a>
</h2>
<p>The default values of <code><a href="https://rdrr.io/r/stats/setNames.html">setNames()</a></code> are a little hard to understand, because the default value of the first argument is the second argument. It was defined this way to make it possible to name a character vector with itself:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cake"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    apple   banana     cake </span></span>
<span><span class="co">#&gt;  "apple" "banana"   "cake"</span></span></code></pre></div>
<p>But that decision leads to a function signature that violates one of the principles of Chapter <a href="args-data-details.html#args-data-details">7</a>: a required argument comes after an optional argument. Fortunately, we can fix this easily and still preserve the useful ability to name a vector with itself:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cake"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    apple   banana     cake </span></span>
<span><span class="co">#&gt;  "apple" "banana"   "cake"</span></span></code></pre></div>
<p>This helps to emphasise that <code>x</code> is the primary argument.</p>
</div>
<div id="what-about-bad-inputs" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> What about bad inputs?<a class="anchor" aria-label="anchor" href="#what-about-bad-inputs"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we’ve considered how the function works with correct inputs, it’s time to consider how it should work with malformed inputs. The current function checks neither the length not the type:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set_names</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    a &lt;NA&gt; &lt;NA&gt; </span></span>
<span><span class="co">#&gt;    1    2    3</span></span>
<span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; c("a", "b", "c")                d      c("e", "f") </span></span>
<span><span class="co">#&gt;                1                2                3</span></span></code></pre></div>
<p>We can resolve this by asserting that the names should always be a character vector, and should have the same length as <code>x</code>:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"`names` must be a character vector the same length as `x`."</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: `names` must be a character vector the same length as `x`.</span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">letters</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: `names` must be a character vector the same length as `x`.</span></span></code></pre></div>
<p>You could also frame this test using vctrs assertions:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vctrs.r-lib.org/">vctrs</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">names</span>, ptype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that I slipped in an assertion that <code>x</code> should be a vector. This slightly improves the error message if you accidentally supply the wrong sort of input to <code>set_names()</code>:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">mean</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in names(object) &lt;- nm: names() applied to a non-vector</span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="va">mean</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `set_names()`:</span></span>
<span><span class="co">#&gt; ! `x` must be a vector, not a function.</span></span></code></pre></div>
<p>Note that we’re simply checking the length of <code>names</code> here, rather than recycling it, i.e. the invariant is <code>vec_size(set_names(x, y))</code> is <code>vec_size(x)</code>, not <code>vec_size_common(x, y)</code>. I think this is the correct behaviour because you usually add names to a vector to create a lookup table, and a lookup table is not useful if there are duplicated names. This makes <code>set_names()</code> less general in return for better error messages when you do something suspicious (and you can always use an explicit <code>rep_along()</code> if do want this behaviour.)</p>
</div>
<div id="how-could-we-extend-this-function" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> How could we extend this function?<a class="anchor" aria-label="anchor" href="#how-could-we-extend-this-function"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we’ve modified the function so it doesn’t violate the principles in this book, we can think about how we might extend it. Currently the function is only useful for setting names to a constant. Maybe we could extend it to also make it easier to change existing names? One way to do that would be to allow <code>names</code> to be a function:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.function.html">is.function</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">names</span>, ptype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="va">x</span>, <span class="va">toupper</span><span class="op">)</span></span>
<span><span class="co">#&gt; A B C </span></span>
<span><span class="co">#&gt; 1 2 3</span></span></code></pre></div>
<p>We could also support anonymous function formula shortcut used in many places in the tidyverse.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.function.html">is.function</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span> <span class="op">||</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_formula.html">is_formula</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fun</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/as_function.html">as_function</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span></span>
<span>    <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu">fun</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">names</span>, ptype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="va">x</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"x-"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; x-a x-b x-c </span></span>
<span><span class="co">#&gt;   1   2   3</span></span></code></pre></div>
<p>Now <code>set_names()</code> supports overriding and modifying names. What about removing them? It turns out that <code><a href="https://rdrr.io/r/stats/setNames.html">setNames()</a></code> supported this, but our stricter checks prohibit:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `set_names()`:</span></span>
<span><span class="co">#&gt; ! `names` must be a vector, not `NULL`.</span></span></code></pre></div>
<p>We can fix this with another clause:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.function.html">is.function</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span> <span class="op">||</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_formula.html">is_formula</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">fun</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/as_function.html">as_function</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span></span>
<span>      <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu">fun</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span></code></pre></div>
<p>However, I think this has muddied the logic. To resolve it, I think we should pull out the checking code into a separate function. After trying out a <a href="https://github.com/tidyverse/principles/issues/79">few approaches</a>, I ended up with:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">names</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">names</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_is</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">names</span>, ptype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.function.html">is.function</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">check_names_2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu">is.formula</span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">check_names_2</span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/as_function.html">as_function</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html">abort</a></span><span class="op">(</span><span class="st">"`names` must be NULL, a function or formula, or a vector"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This then replaces <code><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert()</a></code> in <code>set_names()</code>. I separate the input checking and implementation with a blank line to help visually group the parts of the function.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu">check_names</span><span class="op">(</span><span class="va">names</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We <em>could</em> simplify the function even further, but I think this is a bad idea becaues it mingles input validation with implementation:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Don't do this</span></span>
<span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">check_names</span><span class="op">(</span><span class="va">names</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Or even</span></span>
<span><span class="va">set_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">names</span> <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">`names&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_assert.html">vec_assert</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu">check_names</span><span class="op">(</span><span class="va">names</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="compared-to-rlangset_names" class="section level2" number="9.6">
<h2>
<span class="header-section-number">9.6</span> Compared to <code>rlang::set_names()</code><a class="anchor" aria-label="anchor" href="#compared-to-rlangset_names"><i class="fas fa-link"></i></a>
</h2>
<p>If you’re familiar with rlang, you might notice that we’ve ended up with something rather similar to <code><a href="https://rlang.r-lib.org/reference/set_names.html">rlang::set_names()</a></code>. However, these careful analysis in this chapter has lead to a few differences. <code><a href="https://rlang.r-lib.org/reference/set_names.html">rlang::set_names()</a></code>:</p>
<ul>
<li><p>Calls the second argument <code>nm</code>, instead of something more descriptive.
I think this is simply because we never sat down and fully considered the
interface.</p></li>
<li><p>Coerces <code>nm</code> to character vector. This allows <code>rlang::set_names(1:4)</code> to
automatically name the vector, but this seems a relatively weak new feature
in return for the cost of not throwing an error message if you provide an
unsual vector type. (Both lists and data frames have <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> methods
so this will work for basically any type of vector, even if completely
inappropriate.)</p></li>
<li><p>Passes <code>...</code> on to function <code>nm</code>. I now think that decision was a
mistake: it substantially complicates the interface in return for a
relatively small investment.</p></li>
</ul>
</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="args-independence.html"><span class="header-section-number">8</span> Avoid dependencies between arguments</a></div>
<div class="next"><a href="def-required.html"><span class="header-section-number">10</span> Required args shouldn’t have defaults</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#case-study-setnames"><span class="header-section-number">9</span> Case study: setNames()</a></li>
<li><a class="nav-link" href="#what-does-setnames-do"><span class="header-section-number">9.1</span> What does setNames() do?</a></li>
<li><a class="nav-link" href="#how-can-we-improve-the-names"><span class="header-section-number">9.2</span> How can we improve the names?</a></li>
<li><a class="nav-link" href="#what-about-the-default-values"><span class="header-section-number">9.3</span> What about the default values?</a></li>
<li><a class="nav-link" href="#what-about-bad-inputs"><span class="header-section-number">9.4</span> What about bad inputs?</a></li>
<li><a class="nav-link" href="#how-could-we-extend-this-function"><span class="header-section-number">9.5</span> How could we extend this function?</a></li>
<li><a class="nav-link" href="#compared-to-rlangset_names"><span class="header-section-number">9.6</span> Compared to rlang::set_names()</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="http://github.com/tidyverse/design/blob/main/cs-setNames.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="http://github.com/tidyverse/design/edit/main/cs-setNames.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Tidyverse design guide</strong>" was written by Tidyverse team. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
