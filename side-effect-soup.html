<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>30 Side-effect soup | Tidyverse design guide</title>
<meta name="author" content="Tidyverse team">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="30 Side-effect soup | Tidyverse design guide">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="30 Side-effect soup | Tidyverse design guide">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115082821-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="Side-effect soup occurs when you mix side-effects and regular computation within the same function.  30.1 What is a side-effect? There are two main types of side-effect: those that give feedback...">
<meta property="og:description" content="Side-effect soup occurs when you mix side-effects and regular computation within the same function.  30.1 What is a side-effect? There are two main types of side-effect: those that give feedback...">
<meta name="twitter:description" content="Side-effect soup occurs when you mix side-effects and regular computation within the same function.  30.1 What is a side-effect? There are two main types of side-effect: those that give feedback...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Tidyverse design guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="structure.html"><span class="header-section-number">1</span> Structure</a></li>
<li><a class="" href="unifying-principles.html"><span class="header-section-number">2</span> Unifying principles</a></li>
<li class="book-part">Implementation</li>
<li><a class="" href="names-attribute.html"><span class="header-section-number">3</span> Names attribute</a></li>
<li><a class="" href="call-data-details.html"><span class="header-section-number">4</span> Name details arguments</a></li>
<li><a class="" href="function-names.html"><span class="header-section-number">5</span> Function names</a></li>
<li class="book-part">Interface: inputs</li>
<li><a class="" href="args-hidden.html"><span class="header-section-number">6</span> Avoid hidden arguments</a></li>
<li><a class="" href="args-data-details.html"><span class="header-section-number">7</span> Data, descriptors, details</a></li>
<li><a class="" href="args-independence.html"><span class="header-section-number">8</span> Avoid dependencies between arguments</a></li>
<li><a class="" href="case-study-setnames.html"><span class="header-section-number">9</span> Case study: setNames()</a></li>
<li class="book-part">Interface: default values</li>
<li><a class="" href="def-required.html"><span class="header-section-number">10</span> Required args shouldn’t have defaults</a></li>
<li><a class="" href="cs-rep.html"><span class="header-section-number">11</span> Case study: rep()</a></li>
<li><a class="" href="def-enum.html"><span class="header-section-number">12</span> Enumerate possible options</a></li>
<li><a class="" href="def-magical.html"><span class="header-section-number">13</span> Avoid magical defaults</a></li>
<li><a class="" href="def-short.html"><span class="header-section-number">14</span> Keep defaults short and sweet</a></li>
<li><a class="" href="def-inform.html"><span class="header-section-number">15</span> Explain important defaults</a></li>
<li><a class="" href="def-user.html"><span class="header-section-number">16</span> User settable defaults</a></li>
<li><a class="" href="cs-rgb.html"><span class="header-section-number">17</span> Case study: rgb()</a></li>
<li class="book-part">Interface: ...</li>
<li><a class="" href="dots-position.html"><span class="header-section-number">18</span> Data, dots, details</a></li>
<li><a class="" href="dots-data.html"><span class="header-section-number">19</span> Making data with …</a></li>
<li><a class="" href="dots-prefix.html"><span class="header-section-number">20</span> Dot prefix</a></li>
<li><a class="" href="dots-inspect.html"><span class="header-section-number">21</span> Inspect the dots</a></li>
<li><a class="" href="cs-mapply-pmap.html"><span class="header-section-number">22</span> Case study: mapply() vs pmap()</a></li>
<li class="book-part">Interface: outputs</li>
<li><a class="" href="out-multi.html"><span class="header-section-number">23</span> Returning multiple values</a></li>
<li><a class="" href="out-type-stability.html"><span class="header-section-number">24</span> Type-stability</a></li>
<li><a class="" href="out-vectorisation.html"><span class="header-section-number">25</span> Vectorisation</a></li>
<li><a class="" href="out-invisible.html"><span class="header-section-number">26</span> Side-effect functions should return invisibly</a></li>
<li class="book-part">Interface: errors</li>
<li><a class="" href="err-call.html"><span class="header-section-number">27</span> Error call</a></li>
<li><a class="" href="err-constructor.html"><span class="header-section-number">28</span> Error constructors</a></li>
<li class="book-part">Interface: changes</li>
<li><a class="" href="changes-multivers.html"><span class="header-section-number">29</span> Work with multiple dependency versions</a></li>
<li class="book-part">Interface: side effects</li>
<li><a class="active" href="side-effect-soup.html"><span class="header-section-number">30</span> Side-effect soup</a></li>
<li><a class="" href="spooky-action.html"><span class="header-section-number">31</span> Spooky action</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="glossary.html"><span class="header-section-number">A</span> Glossary</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="http://github.com/tidyverse/design">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="side-effect-soup" class="section level1" number="30">
<h1>
<span class="header-section-number">30</span> Side-effect soup<a class="anchor" aria-label="anchor" href="#side-effect-soup"><i class="fas fa-link"></i></a>
</h1>
<p>Side-effect soup occurs when you mix side-effects and regular computation within the same function.</p>
<div id="what-is-a-side-effect" class="section level2" number="30.1">
<h2>
<span class="header-section-number">30.1</span> What is a side-effect?<a class="anchor" aria-label="anchor" href="#what-is-a-side-effect"><i class="fas fa-link"></i></a>
</h2>
<p>There are two main types of side-effect:</p>
<ul>
<li>those that give feedback to the user.</li>
<li>those that change some global state.</li>
</ul>
<div id="user-feedback" class="section level3" number="30.1.1">
<h3>
<span class="header-section-number">30.1.1</span> User feedback<a class="anchor" aria-label="anchor" href="#user-feedback"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>Signalling a condition, with <code><a href="https://rdrr.io/r/base/message.html">message()</a></code>, <code><a href="https://rdrr.io/r/base/warning.html">warning()</a></code>, or <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code>.</p></li>
<li><p>Printing to the console with <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code>.</p></li>
<li><p>Drawing to the current graphics device with base graphics or grid.</p></li>
</ul>
</div>
<div id="global-state" class="section level3" number="30.1.2">
<h3>
<span class="header-section-number">30.1.2</span> Global state<a class="anchor" aria-label="anchor" href="#global-state"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>Creating (or modifying) an existing binding with <code>&lt;-</code>.</p></li>
<li><p>Modifying the search path by attaching a package with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>.</p></li>
<li><p>Changing the working directory with <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code>.</p></li>
<li><p>Modifying a file on disk with (e.g.) <code><a href="https://rdrr.io/r/utils/write.table.html">write.csv()</a></code>.</p></li>
<li><p>Changing a global option with <code><a href="https://rdrr.io/r/base/options.html">options()</a></code> or a base graphics parameter with
<code>gpar()</code>.</p></li>
<li><p>Setting the random seed with <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code></p></li>
<li><p>Installing a package.</p></li>
<li><p>Changing environment variables with <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv()</a></code>, or indirectly via a
function like <code><a href="https://rdrr.io/r/base/locales.html">Sys.setlocale()</a></code>.</p></li>
<li><p>Modifying a variable in an enclosing environment with <code><a href="https://rdrr.io/r/base/assign.html">assign()</a></code> or <code>&lt;&lt;-</code>.</p></li>
<li><p>Modifying an object with reference semantics (like R6 or data.table).</p></li>
</ul>
<p>More esoteric side-effects include:</p>
<ul>
<li><p>Detaching a package from the search path with <code><a href="https://rdrr.io/r/base/detach.html">detach()</a></code>.</p></li>
<li><p>Changing the library path, where R looks for packages, with <code><a href="https://rdrr.io/r/base/libPaths.html">.libPaths()</a></code></p></li>
<li><p>Changing the active graphics device with (e.g.) <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code> or <code><a href="https://rdrr.io/r/grDevices/dev.html">dev.off()</a></code>.</p></li>
<li><p>Registering an S4 class, method, or generic with <code><a href="https://rdrr.io/r/methods/setGeneric.html">methods::setGeneric()</a></code>.</p></li>
<li><p>Modifying the internal <code>.Random.seed</code></p></li>
</ul>
</div>
</div>
<div id="what-are-some-examples-14" class="section level2" number="30.2">
<h2>
<span class="header-section-number">30.2</span> What are some examples?<a class="anchor" aria-label="anchor" href="#what-are-some-examples-14"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>The summary of a linear model includes a p-value for the overall<br>
regression. This value is only computed when the summary is printed:
you can see it but you can’t touch it.</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ wt, data = mtcars)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -4.5432 -2.3647 -0.1252  1.4096  6.8727 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  37.2851     1.8776  19.858  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; wt           -5.3445     0.5591  -9.559 1.29e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 3.046 on 30 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.7528, Adjusted R-squared:  0.7446 </span></span>
<span><span class="co">#&gt; F-statistic: 91.38 on 1 and 30 DF,  p-value: 1.294e-10</span></span></code></pre></div>
</li>
</ul>
</div>
<div id="why-is-it-bad" class="section level2" number="30.3">
<h2>
<span class="header-section-number">30.3</span> Why is it bad?<a class="anchor" aria-label="anchor" href="#why-is-it-bad"><i class="fas fa-link"></i></a>
</h2>
<p>Side-effect soup is bad because:</p>
<ul>
<li><p>If a function does some computation and has side-effects, it can be
challenging to extract the results of computation.</p></li>
<li>
<p>Makes code harder to analyse because it may have non-local effects.
Take this code:</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">compute</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">calculate</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<p>If <code><a href="https://dplyr.tidyverse.org/reference/compute.html">compute()</a></code> or <code>calculate()</code> don’t have side-effects then you can
predict what <code>df</code> will be. But if <code><a href="https://dplyr.tidyverse.org/reference/compute.html">compute()</a></code> did
<code>options(stringsAsFactors = FALSE)</code> then <code>df</code> would now contain a
character vector rather than a factor.</p>
</li>
</ul>
<p>Side-effect soup increases the cognitive load of a function so should be used deliberately, and you should be especially cautious when combining them with other techniques that increase cognitive load like tidy-evaluation and type-instability.</p>
</div>
<div id="how-avoid-it" class="section level2" number="30.4">
<h2>
<span class="header-section-number">30.4</span> How avoid it?<a class="anchor" aria-label="anchor" href="#how-avoid-it"><i class="fas fa-link"></i></a>
</h2>
<div id="localise-side-effects" class="section level3" number="30.4.1">
<h3>
<span class="header-section-number">30.4.1</span> Localise side-effects<a class="anchor" aria-label="anchor" href="#localise-side-effects"><i class="fas fa-link"></i></a>
</h3>
<p>Constrain the side-effects to as small a scope as possible, and clean up automatically to avoid side-effects. <a href="http://withr.r-lib.org">withr</a></p>
</div>
<div id="extract-side-effects" class="section level3" number="30.4.2">
<h3>
<span class="header-section-number">30.4.2</span> Extract side-effects<a class="anchor" aria-label="anchor" href="#extract-side-effects"><i class="fas fa-link"></i></a>
</h3>
<p>It’s not side-effects that are bad, so much as mixing them with non-side-effect code.</p>
<p>Put them in a function that is specifically focussed on the side-effect.</p>
<p>If your function is called primarily for its side-effects, it should return the primary data structure (which should be first argument), invisibly. This allows you to call it mid-pipe for its side-effects while allow the primary data to continue flowing through the pipe.</p>
</div>
<div id="make-side-effects-noisy" class="section level3" number="30.4.3">
<h3>
<span class="header-section-number">30.4.3</span> Make side-effects noisy<a class="anchor" aria-label="anchor" href="#make-side-effects-noisy"><i class="fas fa-link"></i></a>
</h3>
<p>Primary purpose of the entire package is side-effects: modifying files on disk to support package and project development. usethis functions are also designed to be noisy: as well as doing it’s job, each usethis function tells you what it’s doing.</p>
<p>But some usethis functions are building blocks for other more complex tasks.</p>
</div>
<div id="provide-an-argument-to-suppress" class="section level3" number="30.4.4">
<h3>
<span class="header-section-number">30.4.4</span> Provide an argument to suppress<a class="anchor" aria-label="anchor" href="#provide-an-argument-to-suppress"><i class="fas fa-link"></i></a>
</h3>
<p>You’ve probably used <code>base::hist()</code> for it’s side-effect of drawing a histogram:</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="side-effects_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>But you might not know that <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code> also returns the result of the computation. If you call <code>plot = FALSE</code> it will simply return the results of the computation:</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xhist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">x</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">xhist</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ breaks  : num [1:20] -4.5 -4 -3.5 -3 -2.5 -2 -1.5 -1 -0.5 0 ...</span></span>
<span><span class="co">#&gt;  $ counts  : int [1:19] 1 17 103 475 1576 4498 9122 15079 19122 19120 ...</span></span>
<span><span class="co">#&gt;  $ density : num [1:19] 0.00002 0.00034 0.00206 0.0095 0.03152 ...</span></span>
<span><span class="co">#&gt;  $ mids    : num [1:19] -4.25 -3.75 -3.25 -2.75 -2.25 -1.75 -1.25 -0.75 -0.25 0.25 ...</span></span>
<span><span class="co">#&gt;  $ xname   : chr "x"</span></span>
<span><span class="co">#&gt;  $ equidist: logi TRUE</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "histogram"</span></span></code></pre></div>
<p>This is a good approach for retro-fitting older functions while making minimal API changes. However, I think it dilutes a function to be both used for plotting and for computing so should be best avoided in newer code.</p>
</div>
<div id="use-the-print-method" class="section level3" number="30.4.5">
<h3>
<span class="header-section-number">30.4.5</span> Use the <code>print()</code> method<a class="anchor" aria-label="anchor" href="#use-the-print-method"><i class="fas fa-link"></i></a>
</h3>
<p>An alternative approach would be to always return the computation, and instead perform the output in the <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> method.</p>
<p>Of course ggplot2 isn’t perfect: it creates an object that specifies the plot, but there’s no easy way to extract the underlying computation so if you’ve used <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> to add lines of best fit, there’s no way to extract the values. Again, you can see the results, but you can’t touch them, which is very frustrating!</p>
</div>
<div id="make-easy-to-undo" class="section level3" number="30.4.6">
<h3>
<span class="header-section-number">30.4.6</span> Make easy to undo<a class="anchor" aria-label="anchor" href="#make-easy-to-undo"><i class="fas fa-link"></i></a>
</h3>
<p>If all of the above techniques fail, you should at least make the side-effect easy to undo. A use technique to do this is to make sure that the function returns the <em>previous</em> values, and that it can take it’s own input.</p>
<p>This is how <code><a href="https://rdrr.io/r/base/options.html">options()</a></code> and <code><a href="https://rdrr.io/r/graphics/par.html">par()</a></code> work. You obviously can’t eliminate those functions because their complete purpose is have global changes! But they are designed in such away that you can easily undo their operation, making it possible to apply on a local basis.</p>
<p>There are two key ideas that make these functions easy to undo:</p>
<ol style="list-style-type: decimal">
<li>
<p>They <a href="https://adv-r.hadley.nz/functions.html#invisible">invisibly return</a>
the previous values as a list:</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>my_option <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>my_option <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ my_option: num 1</span></span></code></pre></div>
</li>
<li>
<p>Instead of <code>n</code> named arguments, they can take a single named list:</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>my_option1 <span class="op">=</span> <span class="fl">1</span>, my_option2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>(I wouldn’t recommend copying this technique, but I’d instead recommend
always taking a single named list. This makes the function because it
has a single way to call it and makes it easy to extend the API in the
future, as discussed in Chapter <a href="dots-data.html#dots-data">19</a>)</p>
</li>
</ol>
<p>Together, this means that you easily can set options temporarily.:</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"my_option1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>my_option1 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"my_option1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"my_option1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>If temporarily setting options in a function, you should always restore the previous values using <code><a href="https://rdrr.io/r/base/on.exit.html">on.exit()</a></code>: this ensures that the code is run regardless of how the function exits.</p>
</div>
</div>
<div id="package-considerations" class="section level2" number="30.5">
<h2>
<span class="header-section-number">30.5</span> Package considerations<a class="anchor" aria-label="anchor" href="#package-considerations"><i class="fas fa-link"></i></a>
</h2>
<p>Code in package is executed at build-time.i.e. if you have:</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For mac and windows, this will record when CRAN built the binary. For linux, when the package was installed.</p>
<p>Beware copying functions from other packages:</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">foofy</span> <span class="op">&lt;-</span> <span class="fu">barfy</span><span class="fu">::</span><span class="va">foofy</span></span></code></pre></div>
<p>Version of barfy might be different between run-time and build-time.</p>
<p>Introduces a build-time dependency.</p>
<p><a href="https://github.com/r-lib/devtools/issues/1788" class="uri">https://github.com/r-lib/devtools/issues/1788</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="changes-multivers.html"><span class="header-section-number">29</span> Work with multiple dependency versions</a></div>
<div class="next"><a href="spooky-action.html"><span class="header-section-number">31</span> Spooky action</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#side-effect-soup"><span class="header-section-number">30</span> Side-effect soup</a></li>
<li>
<a class="nav-link" href="#what-is-a-side-effect"><span class="header-section-number">30.1</span> What is a side-effect?</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#user-feedback"><span class="header-section-number">30.1.1</span> User feedback</a></li>
<li><a class="nav-link" href="#global-state"><span class="header-section-number">30.1.2</span> Global state</a></li>
</ul>
</li>
<li><a class="nav-link" href="#what-are-some-examples-14"><span class="header-section-number">30.2</span> What are some examples?</a></li>
<li><a class="nav-link" href="#why-is-it-bad"><span class="header-section-number">30.3</span> Why is it bad?</a></li>
<li>
<a class="nav-link" href="#how-avoid-it"><span class="header-section-number">30.4</span> How avoid it?</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#localise-side-effects"><span class="header-section-number">30.4.1</span> Localise side-effects</a></li>
<li><a class="nav-link" href="#extract-side-effects"><span class="header-section-number">30.4.2</span> Extract side-effects</a></li>
<li><a class="nav-link" href="#make-side-effects-noisy"><span class="header-section-number">30.4.3</span> Make side-effects noisy</a></li>
<li><a class="nav-link" href="#provide-an-argument-to-suppress"><span class="header-section-number">30.4.4</span> Provide an argument to suppress</a></li>
<li><a class="nav-link" href="#use-the-print-method"><span class="header-section-number">30.4.5</span> Use the print() method</a></li>
<li><a class="nav-link" href="#make-easy-to-undo"><span class="header-section-number">30.4.6</span> Make easy to undo</a></li>
</ul>
</li>
<li><a class="nav-link" href="#package-considerations"><span class="header-section-number">30.5</span> Package considerations</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="http://github.com/tidyverse/design/blob/main/side-effects.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="http://github.com/tidyverse/design/edit/main/side-effects.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Tidyverse design guide</strong>" was written by Tidyverse team. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
